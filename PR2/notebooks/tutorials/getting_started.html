<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting Started with OpenMM &#8212; OpenMM Cookbook &amp; Tutorials PR2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/notebooks.css?v=9b8a9a20" />
    <script src="../../_static/documentation_options.js?v=ba5a7899"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Protein in Water" href="protein_in_water.html" />
    <link rel="prev" title="The OpenMM Tutorials" href="../../tutorials.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="nbsphinx-prolog">
    <a href="getting_started.ipynb">Download Notebook</a>
    <a href="https://github.com/openmm/openmm-cookbook/blob/main/notebooks/tutorials/getting_started.ipynb">View in GitHub</a>
    <a href="https://colab.research.google.com/github/openmm/openmm-cookbook/blob/gh-pages/PR2/colab/notebooks/tutorials/getting_started.ipynb">Open in Google Colab</a>
</div><span class="target" id="index-0"></span><section id="Getting-Started-with-OpenMM">
<h1>Getting Started with OpenMM<a class="headerlink" href="#Getting-Started-with-OpenMM" title="Link to this heading">¶</a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading">¶</a></h2>
<p>OpenMM is a high-performance toolkit for molecular dynamics simulations. This series of tutorials is designed to walk you through the basic steps of using OpenMM to set up and run simulations. Once you have familiarized yourself with these basics, you can consult the <a class="reference internal" href="../../tutorials.html#advanced-tutorials"><span class="std std-ref">list of more advanced tutorials</span></a> to learn how to accomplish more specific simulation tasks.</p>
<p>Before beginning, it is useful to understand a bit about the architecture of OpenMM. The core OpenMM library is written in C++, and the <a class="reference external" href="https://docs.openmm.org/latest/api-c++/">OpenMM C++ API</a> can be used directly to invoke OpenMM from C++ programs. However, OpenMM provides wrappers for other languages as well, such as the <a class="reference external" href="https://docs.openmm.org/latest/api-python/">OpenMM Python API</a>. These tutorials demonstrate how to use OpenMM from its Python API, not only due to the convenience of
working with OpenMM from within Python, but also due to additional OpenMM features that are only available from Python. In particular, the Python API consists of both:</p>
<ul class="simple">
<li><p>A lower-level <a class="reference external" href="https://docs.openmm.org/latest/api-python/library.html">“library layer”</a> that directly wraps OpenMM’s C++ interface and provides tools for building customized molecular simulation scripts, libraries, and applications from scratch, and</p></li>
<li><p>A higher-level <a class="reference external" href="https://docs.openmm.org/latest/api-python/app.html">“application layer”</a> that provides various tools for loading and applying commonly used molecular force fields, reading and writing common trajectory and topology file formats, and reporting properties during simulation runs.</p></li>
</ul>
<p>In general, there are three primary methods of using OpenMM to set up and run molecular simulations:</p>
<ol class="arabic simple">
<li><p>Load a molecular topology, use OpenMM to modify it as needed, parameterize it with a force field, and simulate it. This is the simplest method to perform straightforward simulations of biomolecules in OpenMM. For example, if you have a PDB file with the structure of a particular protein, and you want to solvate it and simulate it with a standard Amber or CHARMM force field, this is the easiest method to do so. This method uses OpenMM’s application layer.</p></li>
<li><p>Use some external programs or tools (<em>e.g.</em>, LEaP from <a class="reference external" href="https://ambermd.org/AmberTools.php">AmberTools</a>, or <a class="reference external" href="https://www.charmm-gui.org/">CHARMM-GUI</a>, to do your modeling and parameterization, and load the resulting input files into OpenMM for simulation. This method can be convenient if your desired modeling workflow is more complex than what OpenMM currently supports, or you wish to use a force field that hasn’t been ported to OpenMM’s native format. It also uses OpenMM’s application
layer.</p></li>
<li><p>Use OpenMM’s library layer to build a molecular system from scratch. This is the most general and flexible way to use OpenMM, but requires you to explicitly define all of the necessary potential energy terms and parameters for the atoms, bonds, angles, torsions, <em>etc.</em> in your simulation, unlike the other methods that handle this setup automatically given a topology and a predefined force field. This approach can be useful to build more complex systems when complete control over system setup
is required. However, it is most useful for studying simple model systems like Lennard-Jones fluid mixtures, bead-spring polymers, and simple coarse-grained models.</p></li>
</ol>
<p>These approaches are not completely exclusive: for instance, it is possible to use OpenMM’s application layer to set up a simulation, and then use the library layer to make manual modifications before running it. However, understanding the basics of these methods is useful for understanding how to build more complex simulation workflows with OpenMM, so these introductory tutorials will walk through each of them in turn. The tutorials will not describe in extensive detail the use of external
programs, such as Amber and CHARMM, for system setup. When they discuss how to use OpenMM to run simulations that have been set up using other tools, links to relevant documentation for these tools will be given. Furthermore, they will not describe in detail the basic theory behind molecular simulations, or discuss how to perform more advanced analysis of simulation results beyond extracting basic thermodynamic properties. For links to resources on related topics not covered directly in these
tutorials, refer to the <a class="reference internal" href="#Further-Reading"><span class="std std-ref">Further Reading</span></a> section of this and other tutorial notebooks.</p>
</section>
<section id="Installing-and-Importing-OpenMM">
<h2>Installing and Importing OpenMM<a class="headerlink" href="#Installing-and-Importing-OpenMM" title="Link to this heading">¶</a></h2>
<p>The most straightforward ways to install OpenMM are through either <a class="reference external" href="https://anaconda.org/conda-forge/openmm">conda-forge</a> or <a class="reference external" href="https://pypi.org/project/OpenMM/">PyPI</a>. If you are using <code class="docutils literal notranslate"><span class="pre">conda</span></code>, then</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>openmm
</pre></div>
</div>
<p>is all you need to get started, but more detailed instructions and a more comprehensive list of installation options can be found <a class="reference external" href="https://docs.openmm.org/latest/userguide/application/01_getting_started.html#installing-openmm">in the OpenMM user manual</a>.</p>
<p>If you are following along with this notebook in Google Colab, then a cell has been inserted at the top of the notebook with commands to automatically install OpenMM into the Colab environment.</p>
<p>Once OpenMM is installed, you can import it in a Python script or Python interactive session:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">openmm</span>
</pre></div>
</div>
</div>
<p>Doing so only gives access to the <a class="reference external" href="https://docs.openmm.org/latest/api-python/library.html">library layer</a> of the Python API. To access the <a class="reference external" href="https://docs.openmm.org/latest/api-python/app.html">application layer</a> that we will mainly be using in this tutorial, and OpenMM’s units API that we will discuss later, use:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">openmm.app</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmm.unit</span>
</pre></div>
</div>
</div>
<p>Next, for this tutorial, we will import some additional packages that will be used later. Note that these are not necessary for using OpenMM; they are just employed here for convenience.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
</pre></div>
</div>
</div>
</section>
<section id="Loading-a-Topology">
<h2>Loading a Topology<a class="headerlink" href="#Loading-a-Topology" title="Link to this heading">¶</a></h2>
<p>This tutorial walks through the first of the three methods described above for using OpenMM. In particular, we will see how to load a protein structure into OpenMM, clean up and prepare the structure for simulation, add solvent, specify a force field, and run a simulation. In this example, we will use a structure of hen egg white lysozyme from the Protein Data Bank with <a class="reference external" href="https://www.rcsb.org/structure/1AKI">PDB ID 1AKI</a>. The structure can be downloaded in PDBx/mmCIF format as
<a class="reference external" href="https://files.rcsb.org/download/1AKI.cif">1AKI.cif</a> from the linked PDB entry; this file is also provided with this tutorial.</p>
<p>To load this file in OpenMM, we can use the <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.pdbxfile.PDBxFile.html">PDBxFile</a> class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pdbx</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PDBxFile</span><span class="p">(</span><span class="s2">&quot;1AKI.cif&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>OpenMM supports loading <a class="reference external" href="https://docs.openmm.org/latest/api-python/app.html#loaders-and-setup">several other kinds</a> of commonly used file formats, including, for example files in the legacy (but ubiquitous) PDB format using <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.pdbfile.PDBFile.html">PDBFile</a>.</p>
<p>The object produced by loading the file has a <code class="docutils literal notranslate"><span class="pre">positions</span></code> attribute, with the actual coordinates contained in the file, as well as a <code class="docutils literal notranslate"><span class="pre">topology</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pdbx</span><span class="o">.</span><span class="n">topology</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Topology; 2 chains, 207 residues, 1079 atoms, 1025 bonds&gt;
</pre></div></div>
</div>
<p>OpenMM <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.topology.Topology.html">Topology</a> objects contain information about the identity and connectivity of the particles in a molecular system. Topology objects arrange their data hierarchically, with each Topology containing a list of chains, each chain a list of residues, and each residue a list of atoms. For biopolymers such as proteins, OpenMM’s concepts of chains and residues generally map onto their standard meanings in
this context. More generally, a residue in a Topology represents a set of atoms that is used by OpenMM to assign simulation parameters from a force field (this is discussed in more detail later). Chains in a Topology provide a convenient way to collect related residues; they are useful to group residues that make up subsets of atoms in a larger molecule.</p>
<p>If we load the structure into a molecular visualization program, we can see that it is missing hydrogen atoms, and contains additional oxygen atoms at the positions of water molecules that are present in the crystal structure of the protein:</p>
<p><img alt="fbcceff70e3a4ad1b30a0e9657b58720" class="no-scaled-link" src="../../_images/1AKI.png" style="width: 512px;" /></p>
<p>We can also see this programmatically using OpenMM by looking at the names of residues (<code class="docutils literal notranslate"><span class="pre">HOH</span></code> residues are the water molecules) and the elements of atoms in the Topology:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">pdbx</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">residues</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Counter({&#39;HOH&#39;: 78,
         &#39;ASN&#39;: 14,
         &#39;GLY&#39;: 12,
         &#39;ALA&#39;: 12,
         &#39;ARG&#39;: 11,
         &#39;SER&#39;: 10,
         &#39;CYS&#39;: 8,
         &#39;LEU&#39;: 8,
         &#39;ASP&#39;: 7,
         &#39;THR&#39;: 7,
         &#39;LYS&#39;: 6,
         &#39;VAL&#39;: 6,
         &#39;TRP&#39;: 6,
         &#39;ILE&#39;: 6,
         &#39;PHE&#39;: 3,
         &#39;TYR&#39;: 3,
         &#39;GLN&#39;: 3,
         &#39;GLU&#39;: 2,
         &#39;MET&#39;: 2,
         &#39;PRO&#39;: 2,
         &#39;HIS&#39;: 1})
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">pdbx</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Counter({&lt;Element carbon&gt;: 613,
         &lt;Element oxygen&gt;: 263,
         &lt;Element nitrogen&gt;: 193,
         &lt;Element sulfur&gt;: 10})
</pre></div></div>
</div>
<p>Before running a simulation, we will want to remove the water molecules present in the structure (so that we can replace them later with a solvent consisting of both water and ions), and we will want to add the necessary hydrogen atoms to the structure.</p>
</section>
<section id="Preparing-the-System">
<h2>Preparing the System<a class="headerlink" href="#Preparing-the-System" title="Link to this heading">¶</a></h2>
<p>The issues described above can be commonly encountered when setting up simulations with structures from the Protein Data Bank. OpenMM contains some simple modeling tools to address them. To use these tools, create a <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.modeller.Modeller.html">Modeller</a> object from a Topology and positions:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeller</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Modeller</span><span class="p">(</span><span class="n">pdbx</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">pdbx</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>First, we can clean up the structure by removing the existing water molecules:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeller</span><span class="o">.</span><span class="n">deleteWater</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>At any time, we can access the current Topology in the Modeller object. We can see that the residues corresponding to the water molecules are now gone:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">modeller</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">residues</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Counter({&#39;ASN&#39;: 14,
         &#39;GLY&#39;: 12,
         &#39;ALA&#39;: 12,
         &#39;ARG&#39;: 11,
         &#39;SER&#39;: 10,
         &#39;CYS&#39;: 8,
         &#39;LEU&#39;: 8,
         &#39;ASP&#39;: 7,
         &#39;THR&#39;: 7,
         &#39;LYS&#39;: 6,
         &#39;VAL&#39;: 6,
         &#39;TRP&#39;: 6,
         &#39;ILE&#39;: 6,
         &#39;PHE&#39;: 3,
         &#39;TYR&#39;: 3,
         &#39;GLN&#39;: 3,
         &#39;GLU&#39;: 2,
         &#39;MET&#39;: 2,
         &#39;PRO&#39;: 2,
         &#39;HIS&#39;: 1})
</pre></div></div>
</div>
<p>In order to go further, we need to specify a <em>force field</em> that defines bonded and non-bonded interaction parameters that specify the potential energy of configurations of our system. In the OpenMM application layer, force fields work by matching <em>residue templates</em> in the force field to residues in a Topology. A residue must have the correct number of atoms of each element, and the correct bonds between them as well as to other residues, to match a residue template in a force field. OpenMM
provides several commonly used force fields for biomolecular simulations; these are <a class="reference external" href="https://docs.openmm.org/latest/userguide/application/02_running_sims.html#force-fields">described in the user guide</a>. Choosing an appropriate force field for your research problem is outside of the scope of this tutorial, but you should be aware of the behavior of the force field you choose and any limitations it has that might be applicable to your system.</p>
<p>Here we will use what OpenMM refers to as the <a class="reference external" href="https://docs.openmm.org/latest/userguide/application/02_running_sims.html#amber19">“Amber19”</a> force field, which includes the Amber ff19SB force field for proteins, among others. To load a force field, create a <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.forcefield.ForceField.html">ForceField</a> object with paths to XML files defining the templates and parameters for the force field:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ff</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ForceField</span><span class="p">(</span><span class="s2">&quot;amber19-all.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;amber19/opc3.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We do not need to place these files in the current working directory to load them. OpenMM tries to look up the force field files using the paths provided first, and if they cannot be found, looks in its data directories for them. Since we are using force fields that are distributed with OpenMM, they are loaded from the data directory that can be found at <code class="docutils literal notranslate"><span class="pre">openmm/app/data</span></code> wherever the OpenMM Python API has been installed. Note that in addition to Amber19, we have loaded parameters for the OPC3
water model (and ions) that are compatible with it.</p>
<p>With a ForceField, Modeller can now add hydrogens to its Topology:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeller</span><span class="o">.</span><span class="n">addHydrogens</span><span class="p">(</span><span class="n">ff</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>For more details and options to control how hydrogens are added, see the documentation for <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.modeller.Modeller.html#openmm.app.modeller.Modeller.addHydrogens">Modeller.addHydrogens()</a>.</p>
<p>Next, we need to solvate the protein. We previously removed water molecules from the loaded structure. Now, we will add them back, along with ions, using Modeller:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeller</span><span class="o">.</span><span class="n">addSolvent</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">,</span> <span class="n">ionicStrength</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">molar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>There are many options to the <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.modeller.Modeller.html#openmm.app.modeller.Modeller.addSolvent">Modeller.addSolvent()</a> method, but in the basic way that we have used it here, it will set up a periodic box and add water around the protein such that no atom in the protein will come closer than the specified padding distance to any atom in a periodic copy of the protein. (For more information about how periodic boundary conditions
work in OpenMM, consult the entry in the <a class="reference external" href="https://github.com/openmm/openmm/wiki/Frequently-Asked-Questions#how-do-periodic-boundary-conditions-work">Frequently Asked Questions</a>.) It will also add ions to neutralize the system and achieve the specified ionic strength. By default, the ions used are <span class="math notranslate nohighlight">\(\ce{Na+}\)</span> and <span class="math notranslate nohighlight">\(\ce{Cl-}\)</span>, but the <code class="docutils literal notranslate"><span class="pre">positiveIon</span></code> and <code class="docutils literal notranslate"><span class="pre">negativeIon</span></code> parameters to addSolvent() allow this to be changed.</p>
<p>You may notice that we have passed quantities with units as arguments to Modeller.addSolvent(). OpenMM’s Python API supports automatic unit conversions and dimension checking through the <a class="reference external" href="https://docs.openmm.org/latest/api-python/app.html#units">openmm.unit</a> package. If raw values without units are provided to OpenMM, it will assume that they are appropriately dimensioned quantities in OpenMM’s <a class="reference external" href="https://docs.openmm.org/latest/userguide/theory/01_introduction.html#units">default unit
system</a>. However, always using the units API can help prevent unit conversion mistakes. More information can be found <a class="reference external" href="https://docs.openmm.org/latest/userguide/library/05_languages_not_cpp.html#units-and-dimensional-analysis">in the user guide</a>.</p>
<p>Finally, we have a topology that is ready for simulation, with all of the added atoms that we need, and periodic box vectors set:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeller</span><span class="o">.</span><span class="n">topology</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Topology; 3 chains, 7044 residues, 22641 atoms, 15750 bonds&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modeller</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">getPeriodicBoxVectors</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(Vec3(x=6.199413656965853, y=0, z=0), Vec3(x=0, y=6.199413656965853, z=0), Vec3(x=0, y=0, z=6.199413656965853)) nm
</pre></div></div>
</div>
<p>Besides hydrogen atoms, Modeller can be used to add extra particles for force fields that require them, <em>e.g.</em>, virtual sites for 4- and 5-site water models, and Drude sites for polarizable force fields. Modeller can also add lipid bilayers, which is useful for simulations of proteins embedded in membranes. For more complex structure preparation and setup tasks, you may need to employ external tools. For PDB structures that require more work than simply adding hydrogen atoms,
<a class="reference external" href="https://github.com/openmm/pdbfixer">PDBFixer</a> may be helpful. It can add heavy atoms and even loops of residues missing from protein structures, remove unwanted molecules, and more.</p>
</section>
<section id="Running-a-Simulation">
<h2>Running a Simulation<a class="headerlink" href="#Running-a-Simulation" title="Link to this heading">¶</a></h2>
<p>Once we have Topology and ForceField objects, we can create an OpenMM <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.System.html">System</a> using the <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.forcefield.ForceField.html#openmm.app.forcefield.ForceField.createSystem">ForceField.createSystem()</a> method. The documentation describes the many options that this method can take, but here we show just the most important ones:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">modeller</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span>
                         <span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PME</span><span class="p">,</span>
                         <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">,</span>
                         <span class="n">constraints</span><span class="o">=</span><span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">nonbondedMethod</span></code> argument controls how nonbonded interactions between atoms will be computed. PME is the particle mesh Ewald method, which is usually preferable when the system you are simulating has charges and uses periodic boundary conditions. The <code class="docutils literal notranslate"><span class="pre">nonbondedCutoff</span></code> distance specifies a cutoff for Lennard-Jones interactions, and controls the splitting between Coulomb interactions computed in direct <em>vs.</em> reciprocal space. More information about the theory used by OpenMM to compute
these interactions can be found in the <a class="reference external" href="https://docs.openmm.org/latest/userguide/theory/02_standard_forces.html#nonbondedforce">user guide</a>. The value of 1 nm selected here is also the default. The <code class="docutils literal notranslate"><span class="pre">constraints</span></code> argument controls which interparticle distances in a simulation OpenMM will apply rigid constraints to. The HBonds option selects all bonds to hydrogen atoms, which typically have large force constants and thus generate high-frequency motion. Constraining them to fixed distances
allows the simulation to use a larger timestep while still remaining stable.</p>
<p>The System object created contains all of the atoms in the topology, as well as OpenMM <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.Force.html">Force</a> objects defining the interactions between them. These Force objects are created by the ForceField when it matches residue templates to residues in the Topology and assigns parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
22641
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">getForces</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;openmm.openmm.HarmonicBondForce; proxy of &lt;Swig Object of type &#39;OpenMM::HarmonicBondForce *&#39; at 0x11a7bf3c0&gt; &gt;,
 &lt;openmm.openmm.NonbondedForce; proxy of &lt;Swig Object of type &#39;OpenMM::NonbondedForce *&#39; at 0x10f495500&gt; &gt;,
 &lt;openmm.openmm.PeriodicTorsionForce; proxy of &lt;Swig Object of type &#39;OpenMM::PeriodicTorsionForce *&#39; at 0x10f495650&gt; &gt;,
 &lt;openmm.openmm.CMAPTorsionForce; proxy of &lt;Swig Object of type &#39;OpenMM::CMAPTorsionForce *&#39; at 0x10f495710&gt; &gt;,
 &lt;openmm.openmm.CMMotionRemover; proxy of &lt;Swig Object of type &#39;OpenMM::CMMotionRemover *&#39; at 0x10f495560&gt; &gt;,
 &lt;openmm.openmm.HarmonicAngleForce; proxy of &lt;Swig Object of type &#39;OpenMM::HarmonicAngleForce *&#39; at 0x10f490990&gt; &gt;]
</pre></div></div>
</div>
<p>Here, we can treat the System object largely as a black box that describes to OpenMM how to calculate the energy and forces for a given set of positions of the atoms in our structure. In a later tutorial, we will see how to build a System and set up Force objects from scratch, without using a predefined ForceField.</p>
<p>To perform molecular dynamics simulations, we need to select an integration algorithm. In OpenMM, we do so by creating an <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.Integrator.html">Integrator</a> object. Subclasses of Integrator define specific integration algorithms. Here, we will use the <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.LangevinMiddleIntegrator.html">LangevinMiddleIntegrator</a>, which uses Langevin dynamics to simulate a System and
maintain its temperature at a fixed setpoint:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">integrator</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">LangevinMiddleIntegrator</span><span class="p">(</span><span class="mf">300.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">,</span> <span class="mf">0.004</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The first parameter sets the temperature, the second sets the friction coefficient (in inverse time units), and the third sets the integration timestep. Choosing appropriate thermostat parameters is beyond the scope of this tutorial, but the timestep chosen here should work with the constraint option we selected earlier.</p>
<p>As is, the integrator will act as a thermostat, causing the total energy of the system to fluctuate in order to maintain the set temperature. However, the system volume will remain fixed. To perform a simulation at constant pressure instead, we will need to add a barostat:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">openmm</span><span class="o">.</span><span class="n">MonteCarloBarostat</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">atmosphere</span><span class="p">,</span> <span class="n">integrator</span><span class="o">.</span><span class="n">getTemperature</span><span class="p">()));</span>
</pre></div>
</div>
</div>
<p>OpenMM provides <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.MonteCarloBarostat.html">MonteCarloBarostat</a> as a barostat that uniformly scales the size of the periodic box vectors. Other, anisotropic barostats are also available. Note that in addition to the desired pressure, we must pass the temperature set in the chosen thermostat to the barostat. Though the barostat does not also regulate the temperature of the system, this temperature must be specified so that the
barostat can calculate the correct probability that a volume adjustment Monte Carlo move should be accepted.</p>
<p>We are now ready to put all of the pieces together and create an OpenMM <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.simulation.Simulation.html">Simulation</a> object:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">modeller</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can access the Topology, System, and Integrator for the Simulation as its <code class="docutils literal notranslate"><span class="pre">topology</span></code>, <code class="docutils literal notranslate"><span class="pre">system</span></code>, and <code class="docutils literal notranslate"><span class="pre">integrator</span></code> attributes. However, the Simulation has also created an OpenMM <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.Context.html">Context</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;openmm.openmm.Context; proxy of &lt;Swig Object of type &#39;OpenMM::Context *&#39; at 0x11f767360&gt; &gt;
</pre></div></div>
</div>
<p>Unlike a System, that just defines information about particles and the interactions between them, a Context stores all of the information about the state of a simulation, including particle positions and velocities. A System object acts somewhat like a template for creating Context objects, and one System could be used to create more than one Context if desired. The interaction parameters, and other properties, stored in a Context are dependent on the parameters set in the System when the
Context was created. If changes are made to a System after a Context has been created from it, the Context will not automatically reflect these changes (although in certain cases, it is possible to update a Context with new parameters from a System).</p>
<p>You may have noticed that we only used the <code class="docutils literal notranslate"><span class="pre">topology</span></code> from our Modeller, and not its <code class="docutils literal notranslate"><span class="pre">positions</span></code>, when creating the System. Now that we have a Context, we can initialize it with the positions from the Modeller.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">modeller</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Although there should not be severe problems like overlapping particles in our initial positions, it is a good idea to run a local energy minimization before starting a simulation. The distances between protein atoms from the PDB structure might differ from their equilibrium values defined by the force field, and the solvent molecules added by the Modeller might not have optimal orientations. Minimizing the energy can prevent large initial forces that could otherwise destabilize a simulation.
OpenMM makes this easy to do:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>OpenMM provides various options for reporting simulation results, which we will explore in more detail in the next tutorial. For now, we can simply use OpenMM’s <a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.statedatareporter.StateDataReporter.html">StateDataReporter</a> to print some basic information about our simulation to a file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">StateDataReporter</span><span class="p">(</span><span class="s2">&quot;simulation.log&quot;</span><span class="p">,</span>
                                                         <span class="n">reportInterval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                         <span class="n">time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>At last, we can run some simulation steps:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">25000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The format of the data file written by the StateDataReporter is very simple:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>simulation.log
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#&#34;Time (ps)&#34;,&#34;Potential Energy (kJ/mole)&#34;,&#34;Temperature (K)&#34;,&#34;Density (g/mL)&#34;
0.4000000000000003,-414456.1200252739,101.29547329495789,0.9750766997706524
0.8000000000000006,-402315.4096746808,169.88594724723103,0.9842334648972402
1.2000000000000008,-393341.3418421857,211.74217284525682,0.9893346735050422
1.6000000000000012,-387354.3225855497,240.16775930792363,0.9909134900476821
2.0000000000000013,-382707.2542261747,255.91778495680424,0.9909134900476821
2.4000000000000017,-379220.9490103484,271.59592640283296,0.99424587932129
2.800000000000002,-376977.17452490446,280.29570038675007,0.9999559383003619
3.2000000000000024,-375428.06519079674,286.519293863457,1.0013580310820545
3.6000000000000028,-374121.08276892174,289.3392525058974,1.0013580310820545
</pre></div></div>
</div>
<p>We can plot the results to qualitatively assess how quickly these parameters approach equilibrium values:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time</span><span class="p">,</span> <span class="n">pe</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;simulation.log&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>

<span class="n">axes_pe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axes_pe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pe</span><span class="p">)</span>
<span class="n">axes_pe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (ps)&quot;</span><span class="p">)</span>
<span class="n">axes_pe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Potential energy (kJ/mol)&quot;</span><span class="p">)</span>

<span class="n">axes_temp</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axes_temp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
<span class="n">axes_temp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (ps)&quot;</span><span class="p">)</span>
<span class="n">axes_temp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">)</span>

<span class="n">axes_rho</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">axes_rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
<span class="n">axes_rho</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (ps)&quot;</span><span class="p">)</span>
<span class="n">axes_rho</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density (g/mL)&quot;</span><span class="p">)</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorials_getting_started_58_0.png" src="../../_images/notebooks_tutorials_getting_started_58_0.png" />
</div>
</div>
<p>We can see that there is a relatively quick jump in the potential energy, temperature, and density as the system equilibrates. Of course, in a production simulation, a longer simulation time would be used, along with more advanced analysis to understand whether or not the structure of the protein is changing over time. The simulation is intentionally kept short for this tutorial, and more complex analysis is out of its scope.</p>
<p>Since the several steps taken in this tutorial are interspersed with additional commands to illustrate their results, the key commands that are actually important for running OpenMM are given in a self-contained script below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">openmm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmm.app</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmm.unit</span>

<span class="c1"># Load the input structure.</span>
<span class="n">pdbx</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PDBxFile</span><span class="p">(</span><span class="s2">&quot;1AKI.cif&quot;</span><span class="p">)</span>

<span class="c1"># Delete existing waters, add hydrogens, and add solvent.</span>
<span class="n">modeller</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Modeller</span><span class="p">(</span><span class="n">pdbx</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">pdbx</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
<span class="n">modeller</span><span class="o">.</span><span class="n">deleteWater</span><span class="p">()</span>
<span class="n">ff</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ForceField</span><span class="p">(</span><span class="s2">&quot;amber19-all.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;amber19/opc3.xml&quot;</span><span class="p">)</span>
<span class="n">modeller</span><span class="o">.</span><span class="n">addHydrogens</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
<span class="n">modeller</span><span class="o">.</span><span class="n">addSolvent</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">,</span> <span class="n">ionicStrength</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">molar</span><span class="p">)</span>

<span class="c1"># Create a System, thermostatting Integrator, and barostat.</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">modeller</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span>
                         <span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PME</span><span class="p">,</span>
                         <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">,</span>
                         <span class="n">constraints</span><span class="o">=</span><span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">HBonds</span><span class="p">)</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">LangevinMiddleIntegrator</span><span class="p">(</span><span class="mf">300.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">,</span> <span class="mf">0.004</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">openmm</span><span class="o">.</span><span class="n">MonteCarloBarostat</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">atmosphere</span><span class="p">,</span> <span class="n">integrator</span><span class="o">.</span><span class="n">getTemperature</span><span class="p">()))</span>

<span class="c1"># Create a Simulation.</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">modeller</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>

<span class="c1"># Minimize the energy of the initial configuration.</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">modeller</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">()</span>

<span class="c1"># Set up logging and run the simulation.</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">StateDataReporter</span><span class="p">(</span><span class="s2">&quot;simulation.log&quot;</span><span class="p">,</span>
                                                         <span class="n">reportInterval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                         <span class="n">time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">25000</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Link to this heading">¶</a></h2>
<p>After following this tutorial, you should now be able to use OpenMM to:</p>
<ul class="simple">
<li><p>Load a PDBx/mmCIF file and perform basic modeling tasks like adding hydrogen atoms and a solvent box.</p></li>
<li><p>Set up a simulation at constant temperature and pressure and run an energy minimization.</p></li>
<li><p>Run molecular dynamics steps and set up OpenMM to write basic thermodynamic properties to an output file.</p></li>
</ul>
<p>In the next tutorial, we will discuss various ways of getting data in and out of OpenMM. We will cover how to read input files in formats designed for other molecular dynamics engines like Amber, and how to get various kinds of data, including simulation trajectories, out of OpenMM while running a simulation.</p>
</section>
<section id="Further-Reading">
<h2>Further Reading<a class="headerlink" href="#Further-Reading" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Relevant sections of the <a class="reference external" href="https://docs.openmm.org/latest/api-python/">User Guide</a>:</p>
<ul>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/userguide/application/02_running_sims.html">Chapter 3: Running Simulations</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/userguide/application/03_model_building_editing.html">Chapter 4: Model Building and Editing</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/userguide/library/05_languages_not_cpp.html#python-api">Section 12.3: Python API</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/">Python API documentation</a> pages for classes used in this tutorial:</p>
<ul>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.forcefield.ForceField.html">ForceField</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.LangevinMiddleIntegrator.html">LangevinMiddleIntegrator</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.modeller.Modeller.html">Modeller</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.openmm.MonteCarloBarostat.html">MonteCarloBarostat</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.pdbxfile.PDBxFile.html">PDBxFile</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.simulation.Simulation.html">Simulation</a></p></li>
<li><p><a class="reference external" href="https://docs.openmm.org/latest/api-python/generated/openmm.app.statedatareporter.StateDataReporter.html">StateDataReporter</a></p></li>
</ul>
</li>
<li><p>Troubleshooting basics:</p>
<ul>
<li><p>If you cannot even <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">openmm</span></code> from Python, make sure that you have followed the <a class="reference external" href="https://docs.openmm.org/latest/userguide/application/01_getting_started.html#installing-openmm">installation instructions</a> carefully.</p></li>
<li><p>If you can import OpenMM in Python, but are encountering problems running simulations, the OpenMM <a class="reference external" href="https://github.com/openmm/openmm/wiki/Frequently-Asked-Questions">Frequently Asked Questions</a> discusses some common errors and how to resolve them.</p></li>
<li><p>If the documentation does not address the problem you are having, feel free to ask for help on the OpenMM <a class="reference external" href="https://github.com/openmm/openmm/discussions">discussion board</a>.</p></li>
</ul>
</li>
</ul>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../../tutorials.html" title="Previous document">The OpenMM Tutorials</a>
        </li>
        <li>
          <a href="protein_in_water.html" title="Next document">Protein in Water</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.png" alt="Logo" />
    
    <h1 class="logo logo-name">OpenMM Cookbook & Tutorials</h1>
    
  </a>
</p>











<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><div class="navigation-scrollbox">
    <div class="nav-toctree">
    <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">The OpenMM Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../tutorials.html#getting-started">Getting Started</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Getting Started with OpenMM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Installing-and-Importing-OpenMM">Installing and Importing OpenMM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Loading-a-Topology">Loading a Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Preparing-the-System">Preparing the System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Running-a-Simulation">Running a Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Further-Reading">Further Reading</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#advanced-tutorials">Advanced Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbook.html">The OpenMM Cookbook</a></li>
</ul>

    </div>
    
    <ul class="extra-nav-links">
        
        <li class="toctree-l1">
            <a href="https://openmm.org">
                OpenMM.org
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/userguide/">
                User's Manual
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/developerguide/">
                Developer Guide
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/api-c++/">
                C++ API reference
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/api-python/">
                Python API reference
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://github.com/openmm/openmm">
                GitHub
            </a>
        </li>
        
    </ul>
    
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, The OpenMM Contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/notebooks/tutorials/getting_started.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>